/* revLifter tag boots v4 */
!function(){"use strict";var e=function(e,t,i,r,n){this.dataCollectorEndpoint=e,this.thirdPartyCookieEndPoint=t,this.cookieLength=i,this.firstPartyCookieDomain=r,this.sessionDays=n,this.queue=window[window.RevLifterObject].q,this.siteId=null,this.userId=null,this.sessionId=null,this.revLifterCookie=null,this.queueHandlers=[],this.customFunctions=[],this.registry={}};e.prototype.bootstrap=function(){0===window.location.pathname.indexOf("/OrderItemDisplay")&&(s("BOOTSTRAP"),this.revLifterCookie=new r(this.cookieLength,this.firstPartyCookieDomain,this.sessionDays),this.revLifterCookie.load(),s("RevLifter Cookie Loaded"),this.queue.process=function(){this.processQueue()}.bind(this),this.queue.push=function(e){Array.prototype.push.apply(this,[e]),this.process()},s("Start initial queue processing"),this.processQueue(),s("Initial queue processing complete"),s("Process all custom functions"),this.processCustomFunctions(),s("All custom functions processed"),s("REVLIFTER COMPLETE"),this.revLifterCookie.persist())},e.prototype.cookie=function(){return this.revLifterCookie},e.prototype.getContext=function(){return this.revLifterCookie.data},e.prototype.getRegistry=function(){return this.registry},e.prototype.newSession=function(){this.revLifterCookie.newSession(),this.revLifterCookie.persist()},e.prototype.processQueue=function(){this.batch=this.queue.splice(0),this.queue.splice(0,this.queue.length);for(var e=0;e<this.batch.length;e++)for(var t=0;t<this.queueHandlers.length;t++)this.queueHandlers[t].handles(this.batch[e][0])&&this.queueHandlers[t].process(this.batch[e])},e.prototype.processCustomFunctions=function(){this.customFunctions.forEach(function(e,t){e()})},e.prototype.registerQueueHandler=function(e){this.queueHandlers.push(e)},e.prototype.createPayloadMessage=function(e,t){return{timeStamp:111111111,payloadType:e,payload:t,context:this.cookie().getData()}},e.prototype.registerCustomFunction=function(e){this.customFunctions.push(e)};var a=new e("https://api.revlifter.io/v1/kinesis-collect","https://api.official-deals.co.uk/v1/pixel",365,"www.boots.com",30),t={handles:function(e){return"load"===e},process:function(e){s("Started LoadQueueHandler processing: "+e[1].replace(".js","")),a.siteId=e[1].replace(".js",""),s("Site identified as "+a.siteId),a.revLifterCookie.isSet()?a.cookie().checkSession():(s("No 1st party cookie set, initialising"),a.cookie().init(a.siteId,n()),a.cookie().persist(),s("Initialised Cookie with values: "+JSON.stringify(a.cookie().getData()))),a.userId=a.cookie().get("u"),a.sessionId=a.cookie().get("s"),s("Finished LoadQueueHandler processing")}};a.registerQueueHandler(t);var i={handles:function(e){return"send"===e},process:function(e){switch(s("Started SendQueueHandler processing:"+e[1]),s("Payload: "+JSON.stringify(e[2])),e[1]){case"dataCollector":s("Making AJAX request to "+a.dataCollectorEndpoint),o(a.dataCollectorEndpoint,JSON.stringify({Data:[e[2]]}),function(e){s("Data collector returned 200 response")})}s("Finished SendQueueHandler Processing")}};a.registerQueueHandler(i);var r=function(e,t,i){this.data={},this.days=e,this.cookieDomain=t,this.sessionDays=i,this.name="REVLIFTER",this.stale=!1};r.prototype.getData=function(){return this.data},r.prototype.checkSession=function(){Math.floor(Date.now()/1e3)>this.data.se&&(this.newSession(),this.save(),this.saveThirdParty())},r.prototype.newSession=function(){this.data.s=n(),this.data.se=Math.floor(Date.now()/1e3)+86400*this.sessionDays,this.stale=!0},r.prototype.load=function(){var e=this.name+"=",t=decodeURIComponent(document.cookie).split(";");window.rlca=t;for(var i=0;i<t.length;i++){for(var r=t[i];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(e)&&""!==r.substring(e.length,r.length))return this.data=JSON.parse(r.substring(e.length,r.length)),this.data}return this.data={},{}},r.prototype.init=function(e,t){this.set("w",e),this.set("u",t),this.newSession(),this.stale=!0},r.prototype.get=function(e){return this.data[e]},r.prototype.set=function(e,t){null===this.data&&this.data.hasOwnProperty(e)||(this.data[e]=t)},r.prototype.save=function(){if(this.data!=={}){var e=new Date;e.setTime(e.getTime()+24*this.days*60*60*1e3);var t="; expires="+e.toGMTString();document.cookie=this.name+"="+JSON.stringify(this.data)+t+"; path=/ ; domain=."+this.cookieDomain,s("First Party Cookie Saved")}},r.prototype.saveThirdParty=function(){var e=document.createElement("img");e.src=a.thirdPartyCookieEndPoint+"?c="+encodeURI(JSON.stringify(this.data)),document.getElementsByTagName("body")[0].appendChild(e),s("Third party cookie pixel drop complete: "+a.thirdPartyCookieEndPoint+"?c="+encodeURI(JSON.stringify(this.data)))},r.prototype.isSet=function(){return 0<Object.keys(this.data).length},r.prototype.persist=function(){this.stale&&(this.save(),this.saveThirdParty(),this.stale=!1)};a.registerCustomFunction(function(e){document.addEventListener("DOMContentLoaded",function(){var e=function(){function c(e){var t=/[-]{0,1}[\d]*[\.]{0,1}[\d]+/g;return(e=e.replace(/,/g,""))&&e.match(t)&&parseFloat(e.match(t)[0])||0}if(0!==window.location.pathname.indexOf("/OrderItemDisplay"))return null;var e,t=null;try{t={items:function(){for(var e=[],t=document.querySelector("#totalNumberOfItems").value,i=document.querySelectorAll("#ShopCartPagingDisplay .row.product_item"),r=0;r<t;r++){var n=r+1,o=(document.querySelector("#orderItem_"+n).value,i[r]);if(!o)throw"missing item";var s=o.querySelector(".basket_product_details");if(!s)throw"missing details";var a={};a.name=s.querySelector("h2 a").innerHTML,a.sku=s.querySelector(".basket_product_sku").innerText,a.sku=a.sku.replace("product sku code ",""),a.quantity=Number(s.querySelector("#qty_paid_"+n).value),a.unitPrice=s.querySelector(".basket_product_price .price.showing_pounds").innerText,a.unitPrice=c(a.unitPrice),a.unitPrice=(u=a.unitPrice/(a.quantity||1),Math.round(100*u)/100),e.push(a)}var u;return e}(),total:c((document.querySelector("#order_totals .total_font.showing_pounds")||{}).innerText),loggedIn:(e="G",window.userType&&"R"==window.userType&&(e="R"),e)}}catch(e){console.log(e),t=null}return t}();e&&revlifter("send","dataCollector",a.createPayloadMessage("userdata",{data:e}))})});var n=function(){var e,t,i="";for(e=0;e<32;e++)t=16*Math.random()|0,8!==e&&12!==e&&16!==e&&20!==e||(i+="-"),i+=(12===e?4:16===e?3&t|8:t).toString(16);return i},o=function(e,t,i){var r="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return n.open("POST",e),n.onreadystatechange=function(){3<n.readyState&&200===n.status&&i(n.responseText)},n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Content-Type","application/json"),n.send(r),n},u=function(e,t){var i=t||window.location.href,r=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(i);return r?r[1]:null},s=function(e){var t=new Date;void 0===window.rlstart?(window.rltiming=0,window.rlstart=t.getMilliseconds()):window.rltiming=t.getMilliseconds()-window.rlstart},c=function(e,t){e.style.opacity=0;var i=function(){e.style.opacity=+e.style.opacity+.1,+e.style.opacity<1?window.requestAnimationFrame&&requestAnimationFrame(i)||setTimeout(i,16):t&&t()};i()};var l=function(e){if(-1!==navigator.appVersion.indexOf("MSIE"))return(n=window.open(e)).opener=null,n;var t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t);var i=t.contentDocument||t.contentWindow.document,r=i.createElement("script");r.text='window.parent = null; window.top = null; window.iframeElement = null; var copen = window.open("'+e+'"); copen.opener = null',i.body.appendChild(r);var n=t.contentWindow.child;return document.body.removeChild(t),n},d=function(){var e=document.createElement("iframe");return e.frameBorder="0",e.scrolling="no",e.style.width="100%",e},p={handles:function(e){return"register_iframe"===e},process:function(e){var t;if(("preview"!==e[1].mode||(t="iframe","undefined"!=typeof Storage&&"true"===localStorage.getItem("rl-preview-"+t)))&&-1<e[1].urls.indexOf(window.location.pathname)){window.addEventListener("message",function(e){a.getRegistry().hasOwnProperty("iframeDomain")&&e.origin.replace("https:","").replace("http:","")===a.getRegistry().iframeDomain&&e.data.hasOwnProperty("revlifter")&&(e.data.revlifter.params.eventOrigin=e.origin,revlifter(e.data.revlifter.handler,e.data.revlifter.params))}),u("reveal")&&setTimeout(function(){revlifter("iframe_offer_reveal",{eventOrigin:e[1].src,revealType:"standard",revealId:u("reveal")})},100);var i=document.getElementById("rlwrapper");i.style.textAlign="center";var r=document.createElement("img");r.id="rlloader",r.src="https://assets.revlifter.io/global/spinners/spinner1.gif",r.style.align="center";var n=encodeURI(window.location.href),o=e[1].src+"?iframe=1&c="+encodeURI(JSON.stringify(a.getContext()))+"&url="+n,s=d();s.src=o,s.style.height="1px",s.style.visibility="hidden",s.style.opacity=0,a.getRegistry().iframe=s,a.getRegistry().iframeDomain=e[1].src,a.getRegistry().iframeLoader=r,i.appendChild(r),i.appendChild(s)}}};a.registerQueueHandler(p);var h={handles:function(e){return"iframe_height_adjust"===e},process:function(e){var t=a.getRegistry().iframe;a.getRegistry().iframeHeight=e[1].height,"visible"===t.style.visibility&&(t.style.height=e[1].height+"px")}};a.registerQueueHandler(h);var f={handles:function(e){return"iframe_loaded"===e},process:function(e){var t=a.getRegistry().iframe;a.getRegistry().iframeLoader.style.display="none",t.style.visibility="visible",t.style.height=a.getRegistry().iframeHeight,c(t)}};a.registerQueueHandler(f);var y={handles:function(e){return"iframe_offer_reveal"===e},process:function(e){var t=d();t.src=e[1].eventOrigin+"/offer-reveal/"+e[1].revealId+"?keyword="+u("keyword"),t.style.height="100%",t.style.top="0",t.style.left="0",t.style.opacity=0,t.style.background="transparent",t.style.zIndex=99999999,t.style.position="fixed",t.allowTransparency="true",a.getRegistry().revealIframe=t,document.body.appendChild(t),c(t)}};a.registerQueueHandler(y);var g={handles:function(e){return"iframe_reveal_close"===e},process:function(e){!function(e,t){e.style.opacity=1;var i=function(){e.style.opacity=+e.style.opacity-.1,0<+e.style.opacity?window.requestAnimationFrame&&requestAnimationFrame(i)||setTimeout(i,16):t&&t()};i()}(a.getRegistry().revealIframe,function(){document.body.removeChild(a.getRegistry().revealIframe)})}};a.registerQueueHandler(g);var m={handles:function(e){return"tab_open_handler"===e},process:function(e){var t=e[1].type,i=e[1].url;switch(t){case"newtab":l(i);break;case"newtabfocus":l(e[1].focusUrl),window.location.href=i;break;default:window.location.href=i}}};a.registerQueueHandler(m),a.bootstrap()}();